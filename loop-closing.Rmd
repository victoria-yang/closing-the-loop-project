---
title: "Closing the Loop"
author: "Chieh-An"
output: html_document
---

## Twitter Setup

Step 1. Create a Twitter account at Twitter.com and register as a developer at the following link: https://developer.twitter.com/

Step 2. You will then need to register a new app (we need to create an app to access the API as that is what the primary us of the API is) at https://apps.twitter.com/

Step 3. Within R you will need to install the packages ROAuth and twitteR
```{r}
library(ROAuth)
library(twitteR)
library(sendmailR)
library(cronR)
```

Step 4. Copy the following details from your Twitter App page. Don'f forget to put them in quotations!

```{r}
api_key <- ""

api_secret <- ""

access_token <- ""

access_token_secret <- ""

setup_twitter_oauth(api_key, api_secret, access_token, access_token_secret)
```

You can now download Tweets but remember you can only search from the previous 6-7 days. Limit the number of tweets you are searching for if you are searching for a popular term using `n=`

### Download Tweets
```{r}

TL <- searchTwitter("educational data mining", n=50, since='2019-04-16', until='2019-04-23')#Make sure you change the dates here to be 6 days from today.
TL <- do.call("rbind", lapply(TL, as.data.frame))
```

You can now look at the data that Twitter has made available and do a quick visualization of your Tweets over time.

```{r}
counts=table(TL$screenName)
barplot(counts, las=2)

#By time of day
hist(TL$created, breaks = "d")
```

Using your Twitter data create an RMarkdown report including several visualizations. Using knitr create an html document of your report. Save your html document to the working directory.

## Setup auto-email

To set up an autogenerated email you will need to install both the sendmailR and cronR packages. The cronR package is a scheduling package that connects to the cron system on your computer while sendmailR gives you access to your gmail account. You may have to hcnage the security settings on your gmail account to make this package work.

```{r}
#install.packages("sendmailR")
#install.packages("cronR")

#Email  
sendmail_options(smtpServer="ASPMX.L.GOOGLE.COM")
address <- as.character("your email")
address <- paste("<", address, ">", sep = "")


from <- "<your email>"
to <- address
subject <- "Loop-Closing"
body <- c(
  "Description."
)

sendmail(from, to, subject, body)


```

Investigate the Chron Scheduler

Mac Users: Open the cronR scheduler by going to the `RStudio Tools` menu -> `Addins` -> `cronR` and hit `execute`. Point cronR at the R script you just created for gmailr and choose to send immediatly.

https://www.bnosac.be/index.php/blog/51-new-rstudio-add-in-to-schedule-r-scripts

Windows users: Can use the built-in Task Scheduler application:

https://rstudio-pubs-static.s3.amazonaws.com/197242_31c29cf17f2c424d83d23bdc52a18c70.html

Use the scheduler to schedule an email to yourself (you may need to check your spam folder if it doesn't arrive)

## Threshold Generate

Can you set the scheduler to send an email triggered by an activity threshold on Twitter? For example, an email is sent if a certain number of Tweets are returned by your search.


